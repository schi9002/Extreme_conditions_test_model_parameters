---
title: "Supplementary Material - Base model assumptions"
author: "Simon Chiu"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
    highlight: kate
  html_document:
    df_print: paged
  pdf_document: default
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
# knitr::opts_chunk$set(echo = TRUE)

library(progress)
library(tidyverse)
library(openxlsx)
library(ggplot2)
library(patchwork)
library(ggh4x)
library(ggpubr)
library(scales)

# devtools::install_github("nicolash2/ggbrace")


load("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity//Data/R/lsa_seq_sample_2023-07-16.RData")
focus_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/focus_df_2023-07-18.RDS")
lsa_bmi_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_bmi_df_2023-07-18.RDS")
det_bmi_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/det_bmi_df_2023-07-16.RDS") %>%
  rename("bmi.output"="bmi", "age.groups.output"="age.groups", "gender.output"="gender")

sensitivity_ran_variables<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/sensitivity_ran_variables_2023-07-17.RDS")
# 
# list.of.focus.variables<-focus_df %>% 
#   arrange(focus.title, gender.input, bmi.input, age.groups.input) %>% 
#   select(focus.title) %>% 
#   group_by(focus.title) %>% filter(row_number()==1)%>% data.frame()
# 
# list.of.focus.variables.levels<-focus_df %>% 
#   arrange(focus.title, gender.input, bmi.input, age.groups.input) %>% 
#   select(focus) %>% 
#   group_by(focus) %>% filter(row_number()==1)%>% data.frame()
# 
derivative.lsa<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa.RDS")

```

# Introduction

# Methods
# Example interpretation of EE

```{r, echo=F, message=F, error=F, warning=F}
lsa_bmi_df %>%  
  filter(focus.title=="FATS Kj per gram" ) %>%
  filter(age.groups.output=="Age 18 19" & bmi.output=="Overweight" & gender.output=="Male") %>% 
  select(input.value,`2057`) %>% 
  mutate(prop=seq(-0.2, 0.2, length.out=20)*100) %>% 
  mutate(`2057`=`2057`*100) %>% 
  ggplot()+
  geom_line(aes(x=prop, y=`2057`))+
  geom_line(aes(x=prop, y=`2057`),
            stat="smooth",method="loess", formula = y ~ x,
              alpha = 0.2)+
  geom_point(aes(x=prop, y=`2057`))+
  xlab("Input assumption")+ylab("Outcome prevalence")+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
  ggbrace::geom_brace(aes(x=c(0.3+1.052632,0.3+1.052632+0.3), y=c(21.97217, 23.65459)),rotate=90, inherit.data=F)+
  ggbrace::geom_brace(aes(x=c(-1.052632,1.052632), y=c(20.46636, 20.46636+1)),rotate=180, inherit.data=F)+
  annotate("text", x = 4, y = 22.8, parse = T, label = as.character(expression("f("*x*"+"*Delta*")-f(x)")))+
  annotate("text", x = -0.1, y = 19, parse = T, label = as.character(expression(~Delta)))+
  annotate("text", x = -0.1, y = 12, parse = T, label = as.character(expression(paste(EE," = ",frac("f(x+"*Delta*")-f(x)", ~Delta)))))+
  theme_bw()



```

# How to interpret results

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.2,fig.height=1*4*2.2}
p.tmp1<-derivative.lsa %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(gender.input=='Male' & age.groups.input=="Age 6 8" & bmi.input=="Overweight") %>%
  filter(gender.output=='Male') %>%
  filter(age.groups.output!="Age 45 49") %>% 
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output, alpha=bmi.output), size=1, show.legend = F)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output, alpha=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
  #                  labels=c("3-5", "18-19", "40-44"))+
  scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                            "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                   labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  scale_alpha_manual(values=c(0.3,0.3,1), )+
  ylab(bquote(atop("Average change in BMI %", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"), alpha = "none")+
  ggtitle("Male outcomes")

p.tmp2<-lsa_bmi_df %>% 
  rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input", 
         "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  filter(`BMI input`=="Overweight" ) %>% 
  filter(`Age input`=="Age 6 8") %>%
  filter(`Age output`!="Age 45 49") %>%
  ggplot()+
  # geom_point(aes(x=input.value, y=diff, color=scenario))+
  geom_smooth(aes(x=input.value, y=`2057`), se=F, linewidth=0.5, color=hue_pal()(3)[3], span=0.25)+
  # geom_line(aes(x=input.value, y=diff, color=scenario))+
  # geom_line(aes(x=input.value, y=base.model.value), linetype="dashed")+
  geom_vline(aes(xintercept=sensitivity_ran_variables %>%  
                   filter(grepl("Body Weight", label), grepl(", M,", label), grepl("Age_6_8", label), grepl("Overweight", label)) %>%
                   select(values) %>% pull, color="Initial assumption"), linetype="dashed", alpha=0.3)+
  facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  scale_colour_manual(values = c("black"))+
  guides(colour = guide_legend(" "))+
  scale_y_continuous(labels = scales::percent, breaks = c(seq(0.05,0.6, 0.15)))+
  ylab("Prevalence of obesity (%) at 2057")+xlab("Assumed Body Weight (kg) for overweight males aged 6 to 8")+
  theme_bw() +theme(legend.position = "bottom")

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)+
  plot_annotation(title = 'Explaination of plots',
                   theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
  theme(legend.position = "bottom")


```


```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.2,fig.height=1*4*2.2}
p.tmp1<-derivative.lsa %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(gender.input=='Male' & age.groups.input=="Age 6 8" & bmi.input=="Overweight") %>%
  filter(gender.output=='Male') %>%
  filter(age.groups.output!="Age 45 49") %>% 
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output, alpha=bmi.output), size=1, show.legend = F)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output, alpha=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
  #                  labels=c("3-5", "18-19", "40-44"))+
  scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                            "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                   labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  scale_alpha_manual(values=c(1,0.3,0.3), )+
  ylab(bquote(atop("Average change in BMI %", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"), alpha = "none")+
  ggtitle("Male outcomes")

p.tmp2<-lsa_bmi_df %>% 
  rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input", 
         "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Underweight & \n Healthy weight") %>% 
  filter(`BMI input`=="Overweight" ) %>% 
  filter(`Age input`=="Age 6 8") %>%
  filter(`Age output`!="Age 45 49") %>%
  ggplot()+
  # geom_point(aes(x=input.value, y=`2057`) ,color=hue_pal()(3)[1])+
  geom_smooth(aes(x=input.value, y=`2057`), se=F, linewidth=0.5, color=hue_pal()(3)[1], span = 0.2)+
  # geom_line(aes(x=input.value, y=diff, color=scenario))+
  # geom_line(aes(x=input.value, y=base.model.value), linetype="dashed")+
  geom_vline(aes(xintercept=sensitivity_ran_variables %>%  
                   filter(grepl("Body Weight", label), grepl(", M,", label), grepl("Age_6_8", label), grepl("Overweight", label)) %>%
                   select(values) %>% pull, color="Initial assumption"), linetype="dashed", alpha=0.3)+
  facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  scale_colour_manual(values = c("black"))+
  scale_y_continuous(labels = scales::percent, breaks = c(seq(0.2,0.9, 0.2)))+
  ylab("Prevalence of Underweight & Healthy weight (%) at 2057")+xlab("Assumed Body Weight (kg) for overweight males aged 6 to 8")+
  theme_bw() +theme(legend.position = "bottom")

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)+
  plot_annotation(title = 'Explaination of plots',
                   theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
  theme(legend.position = "bottom")


```


# Results

# Body Weight 

**Change in Male Body Weight input assumptions**

Changes in base model assumptions for body weight alters how change in energy imbalance impacts BMI category prevalence estimates. The figure below shows the elementary effect for each local sensitivity analysis change Male assumptions body weight assumptions. 

- Changes in the underweight and healthy weight body weight assumptions reducing the sensitivity of the model, where higher assumed body weight reduces the flow into overweight creating a lower overweight BMI % and higher underweight/ health weight BMI %.
- Similarly, higher body weight for obesity cohorts reduces the prevalence at the of the model, and increases the prevalence for overweight outcomes.
- Younger ages impact the BMI outcomes for all older age groups, with the largest impact on the age groups being altered.
- Older age groups do not impact younger outcomes.
- Changes in each BMI categories mainly impacts the outcome of the BMI category being changed and the neighboring BMI category.
    - Assumptions in Healthy weight impacts the underweight and healthy weight and overweight outcome, however has minimal impact on with obesity outcome.
    - Change in the assumptions for overweight main impact the outcome for all BMI category
    - Changing the Obesity assumptions change the obesity and overweight outcomes

```{r Body Weight Male, echo=F, message=F, error=F, warning=F,  fig.width=1*6*1.5,fig.height=1*12*1.5}
derivative.lsa %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  derivative.lsa %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>%   
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Change in BMI", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Male Body Weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

**Change in Female Body Weight input assumptions**

There are similar relationships as noted in the male assumptions.

Additionally;

- The results show that the intergenerational effects.
  - Changes in the female assumptions has a slight impact in younger male age group.
- Larger changes in female outcomes, results in lager impacts in younger age groups.
    - Changes in the high fertility age groups results in proportionally higher change in younger age groups.
      - Change in body weight assumptions for Age 2 peaked at average slope of 15 %/kg resulting in 0.5 %/kg changes in young males, 3.3% of the effect was transferred.
      - Change in body weight assumptions for Age 20 24 peaked at 1 %/kg resulting in a 0.1%/kg change in young males, 10% of the effect was transferred.

```{r Body Weight Female, echo=F, message=F, error=F, warning=F,  fig.width=1*6*1.5,fig.height=1*12*1.5}
derivative.lsa %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  derivative.lsa %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Change in BMI", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Female Body Weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

# Height
Similar to changes in the assumed body weight for each cohort, change in height, impacts the how influential energy surplus and deficits are resulting in changes in the flows between BMI categories.

**Change in Male height input assumptions**

```{r Height Male, echo=F, message=F, error=F, warning=F,  fig.width=1*6*1.5,fig.height=1*12*1.5}
derivative.lsa %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(gender.input=='Male') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  derivative.lsa %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(gender.input=='Male') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Change in BMI", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Male height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

**Change in Female height input assumptions**

```{r Height Female, echo=F, message=F, error=F, warning=F,  fig.width=1*6*1.5,fig.height=1*12*1.5}
derivative.lsa %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(gender.input=='Female') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  derivative.lsa %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(gender.input=='Female') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>%  
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Change in BMI", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Female height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

# Growth Function kJ/day
Changes in the assumption Kj/day needed for growth resulting in relatively small changes in the BMI outcomes. The largest impact occurred in adolescent age groups where the growth assumptions where the largest. The larger observed impact in males was in 9-11 year olds and 12-15 year olds, where on average 1 Kj resulted in 0.2% change in the outcome. 

```{r Growth Function, echo=F, message=F, error=F, warning=F,  fig.width=1*5*1.7 ,fig.height=1*7*1.7}
# Confirm units
# lsa_bmi_df %>%
#   filter(focus.title=="\"Growth Function kJ/day\"" ) %>%
#   select(input.value, `2057`)

derivative.lsa %>%
  filter(focus.title=="\"Growth Function kJ/day\"" ) %>% 
  mutate(gender.input=factor(case_when(grepl("M]", focus)~0,
                                       grepl("F]", focus)~1),
                             levels=c(0,1),
                             labels=c("Male", "Female"))) %>% 
  filter(gender.input=='Male') %>%
  # filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per Kj increase in energy need for growth (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male growth assumptions")+
  
  derivative.lsa %>%
  filter(focus.title=="\"Growth Function kJ/day\"" ) %>% 
  mutate(gender.input=factor(case_when(grepl("M]", focus)~0,
                                       grepl("F]", focus)~1),
                             levels=c(0,1),
                             labels=c("Male", "Female"))) %>% 
  filter(gender.input=='Female') %>%
  # filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  # ylab(bquote(atop("Average change in BMI %", "per Kj increase in energy need for growth (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_blank(),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Female growth assumptions")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Growth function (kJ/day)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.7, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

# Macro nutrients Kj per gram
Each of the food groups are broken down to the macro nutrients; carbohydrate, protein, fats and sugars. The energy from a gram of macronutrients is an model input. Since the input energy assumption for each macronutrient effect the energy for each food group to each age-gender-BMI group, all of the population. This creates highlight sensitivity assumptions.

- The input of macronutrient becomes more sensitive for older age group, this is due the the cumulative impact over the populations life course.
- Higher kJ/g leads to higher daily total dietary intake leading to higher prevalence of overweight and obesity.
- The lowest impact to overweight or obesity was 0.8%/kJ.
- The higher impact was 19.89%/kJ.

```{r macro nutrients Kj per gram, echo=F, message=F, error=F, warning=F,  fig.width=1*4*3.2,fig.height=1*2*3.2}
# Confirm units
# lsa_bmi_df %>%
#   filter(focus.title=="\"NON-SUGAR CARBOHYDRATES Kj per gram\"" ) %>%
#   select(input.value, `2057`)

derivative.lsa %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="\"NON-SUGAR CARBOHYDRATES Kj per gram\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  derivative.lsa %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="FATS Kj per gram" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  derivative.lsa %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="PROTEIN Kj per gram" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  derivative.lsa %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="SUGAR TEF" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 2, ncol=2, guides = "collect")+
  plot_annotation(title = 'Energy density',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.7, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```




**Example of interpretation**
```{r macro nutrients Kj per gram example, echo=F, message=F, error=F, warning=F, fig.width=3*2, fig.height=2*2}
lsa_bmi_df %>% 
  filter(focus.title=="FATS Kj per gram" ) %>%
  filter(age.groups.output=="Age 18 19" & bmi.output=="Overweight" & gender.output=="Male") %>% 
  mutate(`2057`=`2057`*100) %>% 
  select(input.value,`2057`) %>% 
  ggplot()+
  geom_hline(aes(yintercept=det_bmi_df %>% 
                   filter(scenario=="Base model" & age.groups.output=="Age 18 19" & bmi.output=="Overweight" & gender.output=="Male") %>% 
                   mutate(`2057`=`2057`*100) %>% select(`2057`) %>% pull), linetype="dashed")+
  geom_vline(aes(xintercept=sensitivity_ran_variables %>% 
                   filter(label=="FATS Kj per gram" ) %>% 
                   select(values) %>% pull), linetype="dashed")+
  geom_point(aes(x=input.value, y=`2057`))+
  geom_smooth(aes(x=input.value, y=`2057`), se=F)+
  xlab("FATS Kj per gram")+ylab("Prevalence @ 2057 (%)")+
  ggtitle("Males Age 18 19 Overweight")+theme_bw()+
  scale_x_continuous(breaks=c(35,37.7, 38.7, 40))+
  scale_y_continuous(breaks=c(10,20,23.65,30,40,50))
```

# Thermic effect of food (TEF)
The themogenesis effect of food (TEF), is the proportion of the energy used for digestion. A higher TEF means less of the dietary energy is available after digestion. TEF input assumptions impacts whole population, translating to a highly sensitivity input assumption.

- Change in TEF, cumulative over the life course leading to a higher impact for older age groups.
- 1 unit change in the **TEF of carbohydrate** results in a between 26.18 to 488.39 % change in prevalence of underweight and healthy weight.
    - Since TEF unit is a proportion, 1 unit change is too wide, a 0.1 unit change would result in a 2.6% to 48.84% change in the prevalence of underweight.
- 1 unit change in the **TEF of Fat** results in a between 29.54 to 545.79 % change in prevalence of underweight and healthy weight.
    - a 0.1 unit change would result in a 2.95% to 54.58% change in the prevalence of underweight.
- 1 unit change in the **TEF of Protein** results in a between 14.22 to 345.20 % change in prevalence of underweight and healthy weight.
    - a 0.1 unit change would result in a 1.42% to 34.52% change in the prevalence of underweight.
- 1 unit change in the **TEF of Sugar** results in a between 38.45 to 533.02 % change in prevalence of underweight and healthy weight.
    - a 0.1 unit change would result in a 3.85% to 53.30% change in the prevalence of underweight.


```{r TEF, echo=F, message=F, error=F, warning=F,  fig.width=1*4*3.2,fig.height=1*2*3.2}
# Confirm units
# lsa_bmi_df %>%
#   filter(focus.title=="CARBOHYDRATE TEF" ) %>%
#   select(input.value, `2057`)

derivative.lsa %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="CARBOHYDRATE TEF" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 TEF units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  derivative.lsa %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="FATS TEF" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 TEF units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  derivative.lsa %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="PROTEIN TEF" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 TEF units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  derivative.lsa %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="SUGAR TEF" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 TEF units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 2, ncol=2, guides = "collect")+
  plot_annotation(title = 'Thermic Effect of Food (TEF)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```


**Example of interpretation**
```{r TEF example, echo=F, message=F, error=F, warning=F, fig.width=3*2, fig.height=2*2}
lsa_bmi_df %>% 
  filter(focus.title=="FATS TEF" ) %>%
  filter(age.groups.output=="Age 18 19" & bmi.output=="Overweight" & gender.output=="Male") %>% 
  mutate(`2057`=`2057`*100) %>% 
  select(input.value,`2057`) %>% 
  ggplot()+
  geom_hline(aes(yintercept=det_bmi_df %>% 
                   filter(scenario=="Base model" & age.groups.output=="Age 18 19" & bmi.output=="Overweight" & gender.output=="Male") %>% 
                   mutate(`2057`=`2057`*100) %>% select(`2057`) %>% pull), linetype="dashed")+
  geom_vline(aes(xintercept=sensitivity_ran_variables %>% 
                   filter(label=="FATS TEF" ) %>% 
                   select(values) %>% pull), linetype="dashed")+
  geom_point(aes(x=input.value, y=`2057`))+
  geom_smooth(aes(x=input.value, y=`2057`), se=F)+
  xlab("FATS TEF")+ylab("Prevalence @ 2057 (%)")+
  ggtitle("Males Age 18 19 Overweight")+theme_bw()+
  # scale_x_continuous(breaks=c(35,37.7, 38.7, 40))+
  scale_y_continuous(breaks=c(10,20,23.65,30,40,50))
```

# Adult to Adult Social Transmission
Adult to Adult social transmission assumptions impact how changes in physical activity (PAL) and dietary behaviors are transmitted to other adults through role-modelling. This assumptions has little impact in the output, however, because this variable is depended on change of behaviour, role-modelling likely interactions with interventions effects. 

```{r Adult to Adult Social Transmission, echo=F, message=F, error=F, warning=F,  fig.width=1*3*2.7,fig.height=1*2.7*2.7}
# Confirm units
# lsa_bmi_df %>%
#     filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
#   select(input.value, `2057`)

derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Adult Social Transmission of dietary Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Adult to Adult Social Transmission of PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Adult Social Transmission of physical Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Adult to Adult Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
  
```


# Adult to Child Social Transmission
Similar to "Adult to Adult" role-modelling, there is little impact in BMI outcome when Adult to Child role-modelling assumptions are varied.

```{r Adult to Child Social Transmission, echo=F, message=F, error=F, warning=F, fig.width=1*3*2.7,fig.height=1*2.7*2.7}

derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Adult to Child Social Transmission DIET Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Child Social Transmission of dietary Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Adult to Child Social Transmission PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Child Social Transmission of physical Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Adult to Child Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

# Child to Child Social Transmission
Similar to "Adult to Adult" role-modelling, there is little impact in BMI outcome when Child to Child role-modelling assumptions are varied. It possbile that these assumptions ill interact with interventions assumptions.


```{r Child to Child Social Transmission, echo=F, message=F, error=F, warning=F, fig.width=1*3*2.7,fig.height=1*2.7*2.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Child to Child Social Transmission of DIET Behavior" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Child to Child Social Transmission of dietary Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Child to Child Social Transmission of PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Child to Child Social Transmission of physical Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Child to Child Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```


# Infant Reported behaviours
The assumed reported infant behaviours exemplifies the intergenerational effects. However these impacts are minimal.

- The proportion of mother that breast feed impact older age groups, this is because of the increase of energy expenditure caused by breastfeeding. 
- The proportion of infants that either consume non-core foods and TV for greater then 1 hr/day impact younger age groups, higher non-core food consumption and greater TV viewing increases the prevalence of overweight and obesity.


```{r Infant Reported behaviours, echo=F, message=F, error=F, warning=F, fig.width=1*2.2*3,fig.height=1*3.7*3}
# Confirm units
# lsa_bmi_df %>%
  # filter(focus.title=="\"Percentage TV >1 per day reported\"" ) %>%
  # select(input.value, `2057`)

derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="\"Percentage BF >6mths reported\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Percentage of mothers breastfeeding to 6 months", subtitle = "Units: per 1 percentage point change")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="\"Percentage non-core > 0 reported\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Percentage of infants consuming non-core foods", subtitle = "Units: per 1 percentage point change")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="\"Percentage TV >1 per day reported\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Percentage of infants watching TV more than 1 hr/day", subtitle = "Units: per 1 percentage point change")+
  
  plot_layout(nrow = 3, ncol=1, guides = "collect") +
  plot_annotation(title = 'Infant behaviours',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")


```



# Intergenerational OR effects

```{r Intergenerational OR effects, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.5,fig.height=1*5*3.5}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Intercept" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 unit (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Intercept", subtitle = "Units: per 0.01 intercept units")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Parents BMI" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 odds ratio (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Impact of parents BMI on infants weight", subtitle = "Units: per 0.01 odds ratio")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Breastfeeding >=6mth" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 unit (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Impact of breastfeeding on infants weight", subtitle = "Units: per 0.01 odds ratio")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="TV >=1" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 unit (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Impact of TV on infants weight", subtitle = "Units: per 0.01 odds ratio")+
  
    derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Non-core >0" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 unit (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Impact of non-core foods on infants weight", subtitle = "Units: per 0.01 odds ratio")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") +
  plot_annotation(title = 'Logistic regression odds ratio',subtitle = "Odds of overweight or obesity at 2 years",
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) & 
  theme(legend.position = "bottom")

```


# Mortality ratios
Hazard ratios are applied to exogenous mortality rate so predicted population dynamics are maintained. 

- Changing these assumptions impact older age group, primarily cause by higher mortality rates in these age groups.
- Since the primary outcome is a percentage, these ratio have little impact. 

```{r Mortality ratios, echo=F, message=F, error=F, warning=F, fig.width=1*3*2.7,fig.height=1*2*2.7}
derivative.lsa %>%
  filter(focus.title=="BMI Hazards Ratios" ) %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 unit (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Hazards Ratios", subtitle = "Units: per 0.01 hazards ratio") +
    plot_annotation(title = 'Mortality',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")
  
  

```

# METs
Duration and intensive (METs) of physical activity are both used in estimating total energy expenditure. The assumed METs for each of the movement categories is applied to all of the population, which results in highligh sensitivity input assumptions.

- Impact from variations in METs assumptions accumulate over the life cource of the population resulting in higher impacts for older age groups.
- Low MET values for sleep and inactivity aswell as high duration results in high sensitivity.
    - 1 unit increase in **sleep METs** results in a between 20.42% to 312.38% change in obesity.
    - 1 unit increase in **inactive METs** results in a between 12.5% to 206.59% change in obesity.
- Other results;    
    - 1 unit increase in **screen time METs** results in a between 8.76% to 163.84% change in obesity.
    - 1 unit increase in **light physical activity METs** results in a between 4.18% to 74.62% change in obesity.
    - 1 unit increase in **moderate physical activity METs** results in a between 2.97% to 33.48% change in obesity.
    - 1 unit increase in **moderate physical activity METs** results in a between 1.88% to 29.19% change in obesity.
    

```{r METs, echo=F, message=F, error=F, warning=F, fig.width=1*4*3.2,fig.height=1*3*3.2}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
 filter(focus.title=="INACTIVE METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Inactivity", subtitle = "Units: per 0.01 MET units")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="SCREEN TIME METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Screen time", subtitle = "Units: per 0.01 MET units")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="SLEEP METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Sleep", subtitle = "Units: per 0.01 MET units")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="LIGHT PA METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Light physical activity", subtitle = "Units: per 0.01 MET units")+
  
    derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="MODERATE PA METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Moderate physical activity", subtitle = "Units: per 0.01 MET units")+
  
    derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="VIGOROUS PA METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Vigorous physical activity", subtitle = "Units: per 0.01 MET units")+
  
  plot_layout(ncol=2, nrow = 3, guides = "collect") +
  plot_annotation(title = 'Metabolic Equivelence of Task (MET)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) & 
  theme(legend.position = "bottom")
```

# LIGHT PA
Each behaviour is structure so that they are age dependent, observed surveyed behaviours were modelled using a linear regression with age groups as the independnet variable. This creates two variables for each behaviour, the intercept is the level of behaviour at the youngest age group (2 years old) and the change of behaviours over the life course.

- Changes in the intercept assumptions have cumulative impacts over the life course, resulting in higher impacts in older age groups compared to younger age groups.
- Variying age-on-age (AGE SLOPE) change the trajectory of behaviours over the life course, making older age group BMI outcomes sensitivity to changes in age slope.
- For each minute increase in the light physical activity intercept prevalence can change 0.5%.
  - the input assumptions range between 90 mins and 127 mins; a change in 10 mins results in 5% change in outcome.
- For each minute increase in the light physical activity age slope prevalence can change 0.8%.
  - the input assumptions range between 13 mins and 36 mins per age group; a change in 5 mins results in 4% change in outcome.
 

```{r LIGHT PA, echo=F, message=F, error=F, warning=F, fig.width=10, fig.height=10}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily LIGHT PA minutes Reported INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each 1 minute increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Light physical activity - Intercept", subtitle = "Units: per 1 minute")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily LIGHT PA minutes Reported AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each 1 minute increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Light physical activity - Age change", subtitle = "Units: per 1 minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily light physical activity minutes',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# MODERATE PA
```{r MODERATE PA, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily MODERATE PA minutes Reported INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each 1 minute increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moderate physical activity - Intercept", subtitle = "Units: per 1 minute")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily MODERATE PA minutes Reported AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each 1 minute increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moderate physical activity - Age change", subtitle = "Units: per 1 minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily moderate physical activity minutes',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# VIGOROUS PA
```{r VIGOROUS PA, echo=F, message=F, error=F, warning=F,  fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily VIGOROUS PA minutes Reported INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each 1 minute increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Vigorous physical activity - Intercept", subtitle = "Units: per 1 minute")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily VIGOROUS PA minutes Reported AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each 1 minute increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Vigorous physical activity - Age change", subtitle = "Units: per 1 minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily vigorous physical activity minutes',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# SCREEN TIME
```{r SCREEN TIME, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily SCREEN TIME minutes Reported INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each 1 minute increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Screen time - Intercept", subtitle = "Units: per 1 minute")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
 filter(focus.title=="Daily SCREEN TIME minutes Reported AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each 1 minute increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Screen time - Age change", subtitle = "Units: per 1 minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily screen time minutes',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")
```

# SLEEP
```{r SLEEP, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily SLEEP minutes Reported INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each 1 minute increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sleep - Intercept", subtitle = "Units: per 1 minute")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily SLEEP minutes Reported AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each 1 minute increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sleep - Age change", subtitle = "Units: per 1 minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily minutes of sleep',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# Fruit Reported Intake
```{r Fruit Reported Intake, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Fruit Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Fruit consumption - Intercept", subtitle = "Units: per gram")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Fruit Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Fruit consumption - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of fruit',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# Vegetables Reported Intake
```{r Vegetables Reported Intake, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Vegetables Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Vegetable consumption - Intercept", subtitle = "Units: per gram")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Vegetables Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Vegetable consumption - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of vegetables',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# Grains Reported Intake
```{r Grains Reported Intake, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Grains Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Grain consumption - Intercept", subtitle = "Units: per gram")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Grains Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Grain consumption - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of grains',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")
```

# Dairy Reported Intake
```{r Dairy Reported Intake, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Dairy Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dairy consumption - Intercept", subtitle = "Units: per gram")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Dairy Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dairy consumption - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of dairy',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# Meat and Protein Reported
```{r Meat and Protein Reported, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Meat and Protein Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Meat and protein consumption - Intercept", subtitle = "Units: per gram")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Meat and Protein Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Meat and protein consumption - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of meat and protein',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")


```

# Discretionary foods Reported
```{r Discretionary foods Reported, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Discretionary foods Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Discretionary consumption - Intercept", subtitle = "Units: per gram")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Discretionary foods Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Discretionary consumption - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of discretionary',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# Fats and Oils Reported
```{r Fats and Oils Reported, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Fats and Oils Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Fats and Oils consumption - Intercept", subtitle = "Units: per gram")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Fats and Oils Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each gram increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Fats and Oils consumption - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of Fats and Oils',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")


```

# Sugar based beverage Reported
```{r Sugar based beverage Reported, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Sugar based beverage Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each ml increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugar based beverage consumption - Intercept", subtitle = "Units: per ml")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Sugar based beverage Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each ml increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugar based beverage consumption - Age change", subtitle = "Units: per ml")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of sugar based beverage',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")


```

# Water Reported
```{r Water Reported, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Water Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each ml increase at 2-years (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Water consumption - Intercept", subtitle = "Units: per ml")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Water Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "for each ml increase per age group (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Water consumption - Age change", subtitle = "Units: per ml")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of water',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# Initial FM %
**Change in Male height input assumptions**
```{r Initial FM Male, echo=F, message=F, error=F, warning=F,  fig.width=1*6.2*1.5,fig.height=1*12*1.5}
derivative.lsa %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 1))+
      scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  derivative.lsa %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
    scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Change in BMI", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Male initial fat-mass %',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

**Change in Female height input assumptions**
```{r Initial FM Female, echo=F, message=F, error=F, warning=F,  fig.width=1*6.2*1.5,fig.height=1*12*1.5}
derivative.lsa %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 1))+
      scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  derivative.lsa %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
    scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Change in BMI", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Female initial fat-mass %',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```



#  Proportion of nutrients within food group Inputs     
**Grains**

```{r Prop of nutrients within food group Grains, echo=F, message=F, error=F, warning=F,  fig.width=1*2*3.2,fig.height=1*5*3.2}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Grains]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Grains]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Grains]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Grains]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Grains]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within grains',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

**Vegetables**
```{r Prop of nutrients within food group vegetable, echo=F, message=F, error=F, warning=F,  fig.width=1*2*3.2,fig.height=1*5*3.2}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Vegetables]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Vegetables]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Vegetables]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Vegetables]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Vegetables]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within vegetables',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Fruit**
```{r Prop of nutrients within food group Fruit, echo=F, message=F, error=F, warning=F,  fig.width=1*2*3.2,fig.height=1*5*3.2}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Fruit]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Fruit]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Fruit]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Fruit]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Fruit]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within fruit',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```


**Dairy**
```{r Prop of nutrients within food group Dairy, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Dairy]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Dairy]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Dairy]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Dairy]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Dairy]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within dairy',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

**Meat**
```{r Prop of nutrients within food group Meat, echo=F, message=F, error=F, warning=F, fig.width=8, fig.height=6}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Meat]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Meat]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Meat]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Meat]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Meat]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within meat and protein',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")

```

**Fats**
```{r Prop of nutrients within food group Fats, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
# derivative.lsa %>%
#   rename("Gender outcome"="gender.output",
#          "BMI input"="bmi.input",
#          "Age input"="age.groups.input") %>% 
#   filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Fats]" ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
#   facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("BMI outcomes"))+
#   ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Fats]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Fats]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Fats]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Fats]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 4, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within fats and oil',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

**Discretionary foods**
```{r Prop of nutrients within food group Discretionary_foods, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Discretionary_foods]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Discretionary_foods]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Discretionary_foods]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Discretionary_foods]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Discretionary_foods]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within discretionary food',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

**Miscellaneous (Other)**
```{r Prop of nutrients within food group Other, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Other]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Other]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Other]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Other]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Other]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within miscellaneous (Other)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

**Non-sugar-sweetened beverages**
```{r Prop of nutrients within food group NonAlcoholic_beverage, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, NonAlcoholic_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, NonAlcoholic_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, NonAlcoholic_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, NonAlcoholic_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, NonAlcoholic_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within beverage (Non-SSB)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")

```

**Sugar-sweetened beverages**
```{r Prop of nutrients within food group Sugar_Sweetened_beverage, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
# derivative.lsa %>%
#   rename("Gender outcome"="gender.output",
#          "BMI input"="bmi.input",
#          "Age input"="age.groups.input") %>%
#   filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Sugar_Sweetened_beverage]" ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
#   facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("BMI outcomes"))+
#   ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
#   
#   derivative.lsa %>%
#   rename("Gender outcome"="gender.output",
#          "BMI input"="bmi.input",
#          "Age input"="age.groups.input") %>% 
#   filter(focus=="Proportion of nutrients within food group Inputs[Fats, Sugar_Sweetened_beverage]" ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
#   facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("BMI outcomes"))+
#   ggtitle("Dietary fats", subtitle = "Units: per percentage point")+
#   
#   derivative.lsa %>%
#   rename("Gender outcome"="gender.output",
#          "BMI input"="bmi.input",
#          "Age input"="age.groups.input") %>% 
#    filter(focus=="Proportion of nutrients within food group Inputs[Protein, Sugar_Sweetened_beverage]" ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
#   facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("BMI outcomes"))+
#   ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Sugar_Sweetened_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  derivative.lsa %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Sugar_Sweetened_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 2, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within sugar-sweetened beverages',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

# Initial BMI Prevalence Inputs
**Change in Male Initial BMI Prevalence**

```{r Body Male Initial BMI Prevalence, echo=F, message=F, error=F, warning=F,  fig.width=1.1*6*1.5,fig.height=1*12*1.5}
derivative.lsa %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per Initial BMI percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  derivative.lsa %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>%   
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per Initial BMI percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Male Initial BMI Prevalence',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

**Change in Female Initial BMI Prevalence**
```{r Body Female Initial BMI Prevalence, echo=F, message=F, error=F, warning=F,  fig.width=1.1*6*1.5,fig.height=1*12*1.5}
derivative.lsa %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per Initial BMI percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  derivative.lsa %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>%   
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee, color=bmi.output))+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per Initial BMI percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Female Initial BMI Prevalence',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

